<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Component System Test</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            background: #0b0f19;
            color: white;
            font-family: Arial, sans-serif;
            padding: 2rem;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255,255,255,0.05);
            padding: 2rem;
            border-radius: 12px;
        }
        .test-section {
            margin-bottom: 2rem;
            padding: 1rem;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }
        .status-indicator {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .status-success {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }
        .status-error {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            margin: 0.25rem;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <!-- Global Components Placeholder -->
    <div id="global-banner"></div>

    <div class="test-container">
        <h1>ðŸ§ª Component Injection System Test</h1>
        <p>This page tests the universal component system.</p>

        <div class="test-section">
            <h2>Banner Component</h2>
            <p id="banner-status">Checking...</p>
            <button onclick="testBanner()">Retest Banner</button>
            <button onclick="toggleBanner()">Toggle Banner</button>
        </div>

        <div class="test-section">
            <h2>Component System Status</h2>
            <pre id="system-log" style="background: black; padding: 1rem; border-radius: 4px; overflow-x: auto;"></pre>
        </div>

        <div class="test-section">
            <h2>Quick Actions</h2>
            <button onclick="clearBannerDismissal()">Reset Banner Dismissal</button>
            <button onclick="location.reload()">Reload Page</button>
        </div>

        <div class="test-section">
            <h2>Test Results</h2>
            <ul id="test-results"></ul>
        </div>
    </div>

    <script src="components.js"></script>
    <script>
        // Wait for components to load
        setTimeout(() => {
            runTests();
        }, 500);

        function runTests() {
            const results = [];
            const resultsEl = document.getElementById('test-results');
            resultsEl.innerHTML = '';

            // Test 1: Check if GlobalComponents exists
            if (typeof GlobalComponents !== 'undefined') {
                results.push({ name: 'GlobalComponents loaded', status: 'pass' });
            } else {
                results.push({ name: 'GlobalComponents loaded', status: 'fail', error: 'Not defined' });
            }

            // Test 2: Check if banner component exists
            if (GlobalComponents && GlobalComponents.banner) {
                results.push({ name: 'Banner component exists', status: 'pass' });
            } else {
                results.push({ name: 'Banner component exists', status: 'fail' });
            }

            // Test 3: Check if banner is enabled
            if (GlobalComponents?.banner?.enabled) {
                results.push({ name: 'Banner enabled', status: 'pass' });
            } else {
                results.push({ name: 'Banner enabled', status: 'fail', error: 'Set enabled: true' });
            }

            // Test 4: Check if banner injected
            const bannerEl = document.getElementById('launchBanner');
            if (bannerEl) {
                results.push({ name: 'Banner injected into DOM', status: 'pass' });
            } else {
                results.push({ name: 'Banner injected into DOM', status: 'fail' });
            }

            // Test 5: Check banner functions
            if (typeof GlobalComponents?.banner?.close === 'function') {
                results.push({ name: 'Banner close() function', status: 'pass' });
            } else {
                results.push({ name: 'Banner close() function', status: 'fail' });
            }

            // Display results
            results.forEach(test => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span class="status-indicator status-${test.status === 'pass' ? 'success' : 'error'}">
                        ${test.status === 'pass' ? 'âœ“' : 'âœ—'}
                    </span>
                    ${test.name}
                    ${test.error ? ` <span style="color: #ef4444;">- ${test.error}</span>` : ''}
                `;
                resultsEl.appendChild(li);
            });

            // Update banner status
            const statusEl = document.getElementById('banner-status');
            const passed = results.filter(t => t.status === 'pass').length;
            const total = results.length;

            if (passed === total) {
                statusEl.innerHTML = `<span class="status-indicator status-success">âœ“ All Tests Passed (${passed}/${total})</span>`;
            } else {
                statusEl.innerHTML = `<span class="status-indicator status-error">âœ— ${total - passed} Failed (${passed}/${total} passed)</span>`;
            }

            // Update system log
            const logEl = document.getElementById('system-log');
            logEl.textContent = JSON.stringify({
                componentsLoaded: typeof GlobalComponents !== 'undefined',
                bannerEnabled: GlobalComponents?.banner?.enabled,
                bannerInjected: !!document.getElementById('launchBanner'),
                localStorage: {
                    bannerClosed: localStorage.getItem('bannerClosed')
                }
            }, null, 2);
        }

        function testBanner() {
            runTests();
        }

        function toggleBanner() {
            const banner = document.getElementById('launchBanner');
            if (banner) {
                if (banner.style.display === 'none') {
                    banner.style.display = 'block';
                    localStorage.removeItem('bannerClosed');
                } else {
                    GlobalComponents.banner.close();
                }
                setTimeout(runTests, 300);
            }
        }

        function clearBannerDismissal() {
            localStorage.removeItem('bannerClosed');
            alert('Banner dismissal cleared! Reload to see banner again.');
            location.reload();
        }
    </script>
</body>
</html>
